<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Messenger: @Rekz Banz</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 30px;
      background-color: #19124e;
      color: #fefeff;
    }
    h1 { color: #fefeff; }
    button {
      padding: 15px 30px;
      font-size: 20px;
      background-color: #007BFF;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 20px;
    }
    button:hover { background-color: #0056b3; }
    button:disabled { background-color: #ccc; cursor: default; }
    .question { margin-bottom: 25px; }
    .correct { color: #00ff88; font-weight: bold; }
    .wrong { color: #ff5577; font-weight: bold; }
    .highlight { margin-top: 10px; }
    input[type="radio"] { transform: scale(1.5); margin-right: 10px; }
    #finishBtn { font-size: 2em; padding: .1em 1em; }
    .nav-buttons { margin-top: 20px; display: flex; gap: 10px; }

    #codeInput {
      font-size: 15px;
      padding: 10px 20px;
      width: 300px;
      border-radius: 8px;
      border: 2px solid #888;
    }

    #codeInput::placeholder { font-size: 15px; }

    /* Smaller font for Enter Access Code */
    #accessSection h2 {
      font-size: 1.2em;
      margin-bottom: 10px;
    }

    /* Style for filename display above access code */
    #fileDisplay {
      font-size: 1.3em;
      font-weight: bold;
      margin-bottom: 5px;
      color: #9fe3ff;
    }
  </style>
</head>

<body>
  <div id="accessSection">
    <p id="fileDisplay"></p> <!-- NEW filename display -->
    <h2>Enter Access Code</h2>
    <div style="position:relative; display:inline-block;">
      <input type="password" id="codeInput" placeholder="Enter code here"
        style="padding-right:45px;">
    
      <span id="toggleEye"
        style="
          position:absolute;
          right:12px;
          top:50%;
          transform:translateY(-50%);
          cursor:pointer;
          font-size:20px;
          color:#9fe3ff;
          user-select:none;
        "
      >üëÅÔ∏è</span>
    </div>
    
    <br>
    <button type="button" id="accessSubmit" style="padding:10px 40px; font-size:20px;">Login</button>

    <span id="contactLink" style="margin-left:16px; font-size:14px; text-decoration:underline; cursor:pointer; color:#9fe3ff;">
     Contact here! 
    </span>


    <p id="message" aria-live="polite"></p>
    <br>
    <p id="tipsArea">Loading tips...</p>
  </div>

  <div id="mainContent" style="display:none;">
    <div id="reviewerSection">
      <h1>Reviewer: Laws & Jurisprudence-(Part4)</h1>
 
 
 
      <button onclick="showQuiz()">Start Quiz</button>
    </div>

    <div id="quizSection" style="display:none;">
      <h1>Quiz: Laws & Jurisprudence-(Part4)</h1>
      <p style="font-size: 15px; font-weight: 600; margin: 0;">Multiple-Choice Quiz (random items)</p>
      <form id="quizForm"></form>

      <div class="nav-buttons">
        <button id="finishBtn">Score</button>
        <button type="button" onclick="refreshQuiz()">Restart Quiz</button>
        <button type="button" onclick="backToReviewer()">Reviewer</button>
      </div>
      <div id="result" class="highlight"></div>
    </div>
  </div>

<!-- CONTACT POPUP MODAL -->
<div id="contactModalBG" style="
  display:none; 
  position:fixed; 
  top:0; left:0; 
  width:100%; height:100%; 
  background:rgba(0,0,0,0.6); 
  z-index:1000;
">
  <div id="contactModal" style="
    background:#ffffff; 
    color:#000; 
    width:90%; 
    max-width:450px; 
    margin:80px auto; 
    padding:25px; 
    border-radius:12px; 
    box-shadow:0 0 15px rgba(0,0,0,0.5);
  ">

    <h2 style="margin-top:0; font-size:22px; text-align:center;">
      Fill-in with your details here. <br>I'll contact you shortly!
    </h2>

    <label>Name:</label>
    <input id="c_name" type="text" style="width:100%; padding:8px; margin-bottom:10px;">

    <label>Contact No.:</label>
    <input id="c_contact" type="text" style="width:100%; padding:8px; margin-bottom:10px;">

    <label>Social Media Account:</label>
    <input id="c_social" type="text" style="width:100%; padding:8px; margin-bottom:10px;">

    <label>Request / Comment:</label>
    <textarea id="c_request" style="width:100%; padding:8px; margin-bottom:10px; height:80px;"></textarea>

    <button id="c_submit" style="
      width:100%; padding:10px; 
      background:#007BFF; color:#fff; border:none; border-radius:6px;
      margin-top:10px; font-size:18px;
    ">Submit</button>

    <button id="c_close" style="
      width:100%; padding:10px; 
      background:#444; color:#fff; border:none; border-radius:6px;
      margin-top:10px; font-size:18px;
    ">Close</button>
<!--
    <p style="margin-top:20px; font-size:20px; text-align:center; color:#333;">
      or you can contact this messenger: <b>@Rekz Banz</b>
    </p>
-->

  </div>
</div>


<script>
document.addEventListener("DOMContentLoaded", () => {
    // ===== SHOW / HIDE PASSWORD TOGGLE =====
    const toggleEye = document.getElementById("toggleEye");
  const codeInputEye = document.getElementById("codeInput");

  toggleEye.addEventListener("click", () => {
    if (codeInputEye.type === "password") {
      codeInputEye.type = "text";
      toggleEye.textContent = "üôà"; // hide icon
    } else {
      codeInputEye.type = "password";
      toggleEye.textContent = "üëÅÔ∏è"; // show icon
    }
  });

  // ===== Display filename on login page =====
  const quizTitleEl = document.querySelector("#quizSection h1");
  const displayFileName = quizTitleEl ? quizTitleEl.textContent.replace("Quiz: ", "").trim() : "index.html";
  const fileDisplay = document.getElementById("fileDisplay");
  if (fileDisplay) fileDisplay.textContent = displayFileName;

  // ===== SETTINGS =====
  const BIN_URL_CODE = "https://api.jsonbin.io/v3/b/68ec800d43b1c97be964fc20/latest";
  const BIN_URL_TIPS = "https://api.jsonbin.io/v3/b/68f1b652ae596e708f180d5d/latest";
  const MASTER_KEY_CODE = "$2a$10$CvK4w8DTXZ1//5H1cpGQIerIT8Kzvk0FQHosdNm.XS0Q9n6sMmaf6";
  const MASTER_KEY_TIPS = "$2a$10$CvK4w8DTXZ1//5H1cpGQIerIT8Kzvk0FQHosdNm.XS0Q9n6sMmaf6";

  // === LOGGER BIN (Access Log) ===
  const BIN_URL_LOG = "https://api.jsonbin.io/v3/b/6911a123d0ea881f40df102a";
  const MASTER_KEY_LOG = MASTER_KEY_CODE;

  // === SCORE LOG BIN (New) ===
  const BIN_URL_SCORE = "https://api.jsonbin.io/v3/b/6912985cd0ea881f40e0cf7c";
  const MASTER_KEY_SCORE = MASTER_KEY_CODE;

  // ===== ELEMENTS =====
  const accessSection = document.getElementById("accessSection");
  const mainContent = document.getElementById("mainContent");
  const codeInput = document.getElementById("codeInput");
  const accessSubmit = document.getElementById("accessSubmit");
  const message = document.getElementById("message");
  const tipsArea = document.getElementById("tipsArea");

// ===============================
// CONTACT MODAL LOGIC (WORKING)
// ===============================

// open modal
const contactLink = document.getElementById("contactLink");
const contactBG = document.getElementById("contactModalBG");
const contactClose = document.getElementById("c_close");
const contactSubmit = document.getElementById("c_submit");

if (contactLink && contactBG) {
  contactLink.addEventListener("click", () => {
    contactBG.style.display = "block";
  });
}

if (contactClose && contactBG) {
  contactClose.addEventListener("click", () => {
    contactBG.style.display = "none";
  });
}
// ===============================
// CONTACT SUBMISSION SAVE LOGIC
// ===============================
const BIN_CONTACT_LOG = "https://api.jsonbin.io/v3/b/69146372d0ea881f40e3989e";
const MASTER_KEY_CONTACT = MASTER_KEY_CODE;

if (contactSubmit) {
  contactSubmit.addEventListener("click", async () => {
    const name = document.getElementById("c_name").value.trim();
    const contact = document.getElementById("c_contact").value.trim();
    const social = document.getElementById("c_social").value.trim();
    const request = document.getElementById("c_request").value.trim();

    if (!name || !contact || !request) {
      alert("Please fill out name, contact, and request/comment.");
      return;
    }

    const quizTitleElLocal = document.querySelector("#quizSection h1");
    const fileName = quizTitleElLocal
      ? quizTitleElLocal.textContent.replace("Quiz: ", "").trim()
      : "index.html";

    const deviceInfo = await getDeviceInfo();

    try {
      const getRes = await fetch(`${BIN_CONTACT_LOG}/latest`, {
        headers: { "X-Master-Key": MASTER_KEY_CONTACT }
      });
      const data = await getRes.json();
      const logs = Array.isArray(data.record) ? data.record : [];

      logs.push({
        event: "Client Request",
        request,
        name,
        contact,
        social,
        filename: fileName,
        timestamp: new Date().toLocaleString(),
        device: deviceInfo
      });

      await fetch(BIN_CONTACT_LOG, {
        method: "PUT",
        headers: {
          "Content-Type": "application/json",
          "X-Master-Key": MASTER_KEY_CONTACT
        },
        body: JSON.stringify(logs)
      });

      alert("Message sent!");
      contactBG.style.display = "none";

    } catch (err) {
      alert("Error sending contact message.");
      console.error(err);
    }
  });
}



  // ===== HELPERS =====
  function findStringKey(obj, keyName) {
    if (!obj || typeof obj !== "object") return undefined;
    for (const k in obj) {
      if (k.toLowerCase() === keyName.toLowerCase() && typeof obj[k] === "string") {
        return obj[k];
      }
      const v = obj[k];
      if (typeof v === "object") {
        const nested = findStringKey(v, keyName);
        if (nested) return nested;
      }
    }
  }

  async function getDeviceInfo() {
    const uaData = navigator.userAgentData || {};
    const ua = navigator.userAgent;
    const platform = navigator.platform;
    const language = navigator.language;
    const screenResolution = `${window.screen.width}x${window.screen.height}`;
    const browserVersion = uaData.brands
      ? uaData.brands.map(b => `${b.brand} ${b.version}`).join(", ")
      : ua;

    // Determine general device type
    const uaLower = ua.toLowerCase();
    let deviceType = "desktop";
    if (/mobi|iphone|android/i.test(uaLower)) {
      deviceType = "mobile";
    } else if (/tablet|ipad|nexus 7|nexus 10/i.test(uaLower)) {
      deviceType = "tablet";
    }

    // Get approximate IP + region/country info (non-identifying)
    let networkInfo = "Unavailable";
    try {
      const res = await fetch("https://ipapi.co/json/");
      if (res.ok) {
        const info = await res.json();
        networkInfo = {
          ip: info.ip,
          city: info.city,
          region: info.region,
          country: info.country_name,
          org: info.org
        };
      }
    } catch {
      networkInfo = "Network lookup failed";
    }

    // Optional: request geolocation with user consent
    const location = await new Promise(resolve => {
      if (!navigator.geolocation) return resolve("Geolocation not supported");
      navigator.geolocation.getCurrentPosition(
        pos => resolve({
          latitude: pos.coords.latitude,
          longitude: pos.coords.longitude,
          accuracy: pos.coords.accuracy
        }),
        () => resolve("Permission denied or unavailable"),
        { timeout: 5000 }
      );
    });

    return {
      ua,
      browserVersion,
      platform,
      language,
      screenResolution,
      deviceType,
      networkInfo,
      location
    };
  }

  async function saveLoginToJsonBin(codeUsed) {
    try {
      // get filename from quiz title h1
      const quizTitleElLocal = document.querySelector("#quizSection h1");
      const fileName = quizTitleElLocal ? quizTitleElLocal.textContent.replace("Quiz: ", "").trim() : "index.html";

      const getRes = await fetch(`${BIN_URL_LOG}/latest`, {
        headers: { "X-Master-Key": MASTER_KEY_LOG }
      });
      const data = await getRes.json();
      const logs = Array.isArray(data.record) ? data.record : [];

      const deviceInfo = await getDeviceInfo();

      logs.push({
        event: "Login Access",
        accessCode: codeUsed,
        filename: fileName,
        timestamp: new Date().toLocaleString(),
        device: deviceInfo
      });

      await fetch(BIN_URL_LOG, {
        method: "PUT",
        headers: {
          "Content-Type": "application/json",
          "X-Master-Key": MASTER_KEY_LOG
        },
        body: JSON.stringify(logs)
      });

      console.log(`‚úÖ Login logged successfully (file: ${fileName}).`);
    } catch (err) {
      console.error("‚ùå Error logging to JSONBin:", err);
    }
  }

  // ===== LOAD TIPS =====
  async function loadTips() {
    try {
      const resp = await fetch(BIN_URL_TIPS, {
        headers: { "X-Master-Key": MASTER_KEY_TIPS, "Content-Type": "application/json" }
      });
      const data = await resp.json();
      const tipsText =
        findStringKey(data, "tips") ||
        "Tips: <br>Press Enter after typing the code.<br>Stay online when entering.<br>For help, contact messenger: @Rekz Banz";
      tipsArea.innerHTML = tipsText;
    } catch (err) {
      console.error("Tips fetch error:", err);
      tipsArea.innerHTML =
        "Could not load page. Please check your internet connection.";
    }
  }
  loadTips();

  // === NEW FUNCTION: Save Quiz Score to JSONBin ===
  async function saveScoreToJsonBin(score, total) {
    try {
      const quizTitleElLocal = document.querySelector("#quizSection h1");
      const fileName = quizTitleElLocal ? quizTitleElLocal.textContent.replace("Quiz: ", "").trim() : "index.html";

      const getRes = await fetch(`${BIN_URL_SCORE}/latest`, {
        headers: { "X-Master-Key": MASTER_KEY_SCORE }
      });
      const data = await getRes.json();
      const logs = Array.isArray(data.record) ? data.record : [];
      const deviceInfo = await getDeviceInfo();

      logs.push({
        event: "Quiz Score",
        score: `${score}/${total}`,
        filename: fileName,
        timestamp: new Date().toLocaleString(),
        device: deviceInfo
      });

      await fetch(BIN_URL_SCORE, {
        method: "PUT",
        headers: {
          "Content-Type": "application/json",
          "X-Master-Key": MASTER_KEY_SCORE
        },
        body: JSON.stringify(logs)
      });
      console.log("‚úÖ Quiz score saved to JSONBin successfully.");
    } catch (err) {
      console.error("‚ùå Error saving quiz score:", err);
    }
  }

  // ===== LOCAL STORAGE =====
  const fileName = window.location.pathname.split("/").pop() || "default";
  const storageKey = "savedAccessCode_" + fileName.replace(/\W+/g, "_");
  const savedCode = localStorage.getItem(storageKey);
  if (savedCode) codeInput.value = savedCode;
  codeInput.addEventListener("input", () =>
    localStorage.setItem(storageKey, codeInput.value)
  );

  // ===== LOGIN HANDLER =====
  codeInput.addEventListener("keyup", (e) => {
    if (e.key === "Enter") accessSubmit.click();
  });

  accessSubmit.addEventListener("click", async () => {
    const input = codeInput.value.trim();
    if (!input) {
      message.textContent = "Please enter the access code.";
      return;
    }

    accessSubmit.disabled = true;
    codeInput.disabled = true;
    message.textContent = "Checking...";

    try {
      const resp = await fetch(BIN_URL_CODE, {
        headers: { "X-Master-Key": MASTER_KEY_CODE, "Content-Type": "application/json" }
      });

      if (!resp.ok) throw new Error(`HTTP ${resp.status}`);
      const data = await resp.json();

      const remoteCode =
        findStringKey(data, "accessCode") ||
        findStringKey(data, "code") ||
        findStringKey(data, "access");

      if (!remoteCode) {
        message.textContent = "Access code not found in storage record.";
        throw new Error("No accessCode in JSON");
      }

      if (input === remoteCode.trim()) {
        accessSection.style.display = "none";
        mainContent.style.display = "block";
        message.textContent = "";
        saveLoginToJsonBin(input); // <<== AUTO LOG TO JSONBIN
        setTimeout(() => {
          const btn = document.querySelector("#mainContent button");
          if (btn) btn.focus();
        }, 100);
      } else {
        message.textContent = "Wrong code. Please go to tips.";
        localStorage.removeItem(storageKey);
        accessSubmit.disabled = false;
        codeInput.disabled = false;
      }
    } catch (err) {
      console.error("Access fetch error:", err);
      message.textContent = "Error fetching code. Check console for details.";
      accessSubmit.disabled = false;
      codeInput.disabled = false;
    }
  });

  // ===== QUIZ LOGIC =====
  const pool = [
  
  
  {q: "Which of the following is NOT a step in the chain of custody process?", choices: ["A) Collecting the sample", "B) Sealing the evidence", "C) Destroying the evidence", "D) Storing the evidence", "E) Documenting the evidence"], correctIndex: 2},

{q: "Cumulative evidence is:", choices: ["A) Evidence of a different kind proving the same fact", "B) Evidence of the same kind proving the same fact", "C) Inadmissible evidence", "D) Evidence that contradicts testimonial evidence", "E) A judicial admission"], correctIndex: 1},

{q: "What essential details must be included in an analytical toxicology request?", choices: ["A) Suspected substance and dosage", "B) A confession from the suspect", "C) The scheduled trial date", "D) The list of witnesses", "E) None of the above"], correctIndex: 0},

{q: "Under Philippine law, which article of the Revised Penal Code deals with the crime of delay in the delivery of a detained person to the proper judicial authorities?", choices: ["A) Article 124", "B) Article 125", "C) Article 126", "D) Article 127", "E) None of the above"], correctIndex: 1},

{q: "Who is/are liable in the crime of plunder?", choices: ["A) Principal only", "B) Principal, accomplice and accessory", "C) Principal and accomplice", "D) Natural Persons only", "E) Juridical person"], correctIndex: 1},

{q: "Which of the following is not an element that constitutes the crime of rape under Philippine law?", choices: ["A) Use of force or intimidation", "B) The victim is a minor under the age of 12", "C) The victim is married to the offender", "D) The act is committed with the victim‚Äôs consent", "E) None of the above"], correctIndex: 3},

{q: "Which of the following describes an attempted rape under Philippine law?", choices: ["A) The perpetrator succeeds in penetrating the victim.", "B) The perpetrator tries to force sexual intercourse but is stopped before penetration.", "C) The perpetrator threatens the victim but does not attempt any physical contact.", "D) The perpetrator verbally harasses the victim without physical contact.", "E) None of the above"], correctIndex: 1},

{q: "CCC was accused of the crime of Frustrated Murder. He used an unlicensed firearm in the killing of DDD. However, due to immediate medical intervention, DDD survived. What are the legal consequences of CCC‚Äôs use of an unlicensed firearm in the crime of Frustrated Murder?", choices: ["A) The use unlicensed firearm shall be absorbed in the crime of Frustrated Murder.", "B) The use unlicensed firearm shall be considered as aggravating circumstance in the crime of Frustrated Murder.", "C) The use unlicensed firearm shall be prosecuted separately.", "D) The use of unlicensed firearm shall make the crime Murder.", "E) None of the above"], correctIndex: 1},

{q: "Under Article 125 of the Revised Penal Code, what is the maximum time that a person can be detained without being delivered to the proper judicial authorities, depending on the offense they are charged with?", choices: ["A) 12 hours", "B) 18 hours", "C) 36 hours", "D) 24 hours for all offenses", "E) None of the above"], correctIndex: 2},

{q: "Electronic documents are admissible if:", choices: ["A) They are printed out", "B) They comply with rules on admissibility and authentication", "C) They are certified by an IT expert", "D) They are filed in government offices", "E) They are signed by police officers"], correctIndex: 1},

{q: "Sandra issued a check worth Php150,000.00 to Carla, but it bounced for insufficient funds when presented at the bank. Carla went to the police station for advice. If you were the police officer, what is the best legal advice to give her?", choices: ["A) File a criminal case against Sandra under BP 22.", "B) Consult a lawyer to prepare a demand letter.", "C) Send a Notice of Dishonor to Sandra.", "D) Simply text Sandra about the bouncing check.", "E) Report the matter to the barangay captain."], correctIndex: 2},

{q: "Which of the following is the penalty if a public official is caught in violation of RA No. 9175 or Chain Saw Act?", choices: ["A) Imprisonment of not less than one (1 ) month nor more than six (6) months and a fine of not less than One thousand pesos (P1,000.00) nor more than Four thousand pesos (P4,000.00) if he/she caught of engine serial number.", "B) Imprisonment of six (6) years and one (1) day to eight (8) years or a fine of not less than Thirty thousand pesos (P30,000.00) but not more than Fifty thousand pesos if he/she caught unlawfully using an unregistered chain saw.", "C) Imprisonment of not less than one (1) month nor more than six (6) months and a fine of not less than One thousand pesos (P1,000.00) for more than Four thousand pesos (P4,000.00) if he/she caught unlawfully import chain saw.", "D) Removed from office and perpetually disqualified from holding any public office.", "E) All"], correctIndex: 4},

{q: "Which is NOT part of the chain of custody process?", choices: ["A) Sample collection", "B) Evidence sealing", "C) Evidence destruction", "D) Evidence storage", "E) Evidence documentation"], correctIndex: 2},

{q: "What is the main purpose of maintaining the chain of custody in handling evidence?", choices: ["A) To speed up laboratory testing", "B) To ensure the integrity of evidence from collection to court", "C) To quickly transfer materials to the prosecutor", "D) To secure storage at the police station only", "E) To produce faster laboratory results"], correctIndex: 1},

{q: "What is the legal term for the act of intentionally killing another person without qualifying circumstances?", choices: ["A) Murder", "B) Homicide", "C) Parricide", "D) Infanticide", "E) None of the above"], correctIndex: 1},

{q: "Which of the following is the primary duty of a peace officer making an arrest?", choices: ["A. To decide on the guilt of the accused", "B. To investigate the crime scene immediately", "C. To deliver the arrested person to the nearest police station or jail without unnecessary delay", "D. To prepare the information and file it directly in court", "E. To secure a certification from the prosecutor"], correctIndex: 2},

{q: "What is the definition of arrest under Rule 113?", choices: ["A. Seizing property to satisfy judgment", "B. Summoning an accused for trial", "C. Taking a person into custody to answer for an offense", "D. Issuing a warrant against a person", "E. Restricting movement temporarily for questioning"], correctIndex: 2},

{q: "What level of proof is required to secure a conviction in criminal cases?", choices: ["A) Preponderance of evidence", "B) Clear and convincing proof", "C) Proof beyond reasonable doubt", "D) Establishing probable cause", "E) Substantial evidence"], correctIndex: 2},

{q: "Who may file a complaint for adultery or concubinage?", choices: ["A. Any peace officer", "B. The offended spouse only", "C. The children of the offended spouse", "D. The prosecutor", "E. Any relative of the offended spouse"], correctIndex: 1},

{q: "Which is an example of object evidence?", choices: ["A. Affidavit of a witness", "B. CCTV footage showing the incident", "C. Medical certificate of injuries", "D. The firearm used in the crime", "E. Police blotter"], correctIndex: 3}


  ];

  function pickRandom(arr, n) {
    const copy = [...arr];
    const result = [];
    while (result.length < n && copy.length > 0) {
      const idx = Math.floor(Math.random() * copy.length);
      result.push(copy.splice(idx, 1)[0]);
    }
    return result;
  }

  function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  function selectRandomChoices(item) {
    const correctChoice = item.choices[item.correctIndex];
    let others = item.choices.filter((_, idx) => idx !== item.correctIndex);
    shuffleArray(others);
    let selected = [correctChoice, ...others.slice(0, 4)];
    shuffleArray(selected);
    item.correctIndex = selected.indexOf(correctChoice);
    item.choices = selected;
  }

  let quizItems = [];

  window.showQuiz = function () {
    document.getElementById("reviewerSection").style.display = "none";
    document.getElementById("quizSection").style.display = "block";
    buildQuiz();
  };

  window.backToReviewer = function () {
    document.getElementById("quizSection").style.display = "none";
    document.getElementById("reviewerSection").style.display = "block";
    document.getElementById("quizForm").innerHTML = "";
    document.getElementById("result").innerHTML = "";
  };

  window.refreshQuiz = function () {
    document.getElementById("quizForm").innerHTML = "";
    document.getElementById("result").innerHTML = "";
    document.getElementById("finishBtn").disabled = false;
    buildQuiz();
  };

  function buildQuiz() {
    quizItems = pickRandom(pool, Math.min(20, pool.length));
    const form = document.getElementById("quizForm");
    form.innerHTML = "";
    quizItems.forEach((item, i) => {
      selectRandomChoices(item);
      const div = document.createElement("div");
      div.className = "question";
      const q = document.createElement("p");
      q.textContent = `${i + 1}. ${item.q}`;
      div.appendChild(q);
      item.choices.forEach((choice, idx) => {
        const label = document.createElement("label");
        const radio = document.createElement("input");
        radio.type = "radio";
        radio.name = `q${i}`;
        radio.value = idx;
        label.appendChild(radio);
        label.appendChild(document.createTextNode(" " + choice));
        div.appendChild(label);
        div.appendChild(document.createElement("br"));
      });
      form.appendChild(div);
    });
  }

  document.getElementById("finishBtn").addEventListener("click", async function () {
    let score = 0;
    const total = quizItems.length;
    for (let i = 0; i < total; i++) {
      const radios = document.querySelectorAll(`input[name="q${i}"]`);
      let selected = -1;
      radios.forEach(r => { if (r.checked) selected = parseInt(r.value); });
      const div = document.getElementById("quizForm").children[i];
      if (selected === quizItems[i].correctIndex) {
        score++;
        div.insertAdjacentHTML("beforeend", "<div class='correct'>‚úî Correct</div>");
      } else {
        const correctAnswer = quizItems[i].choices[quizItems[i].correctIndex];
        div.insertAdjacentHTML("beforeend", `<div class='wrong'>‚úò Wrong. Correct: ${correctAnswer}</div>`);
      }
      radios.forEach(r => r.disabled = true);
    }
    document.getElementById("result").innerHTML = `<h2>Your Score: ${score} / ${total}</h2>`;
    this.disabled = true;

    // üß† Save score to JSONBin
    await saveScoreToJsonBin(score, total);
  });
});
</script>
</body>
</html>

